{% extends "base.html" %}

{% block title %}账号管理 - Telegram采集系统{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span><i class="bi bi-people"></i> Telegram账号管理</span>
                <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addAccountModal">
                    <i class="bi bi-plus-circle"></i> 添加账号
                </button>
            </div>
            <div class="card-body">
                <!-- 账号列表 -->
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>手机号</th>
                                <th>API ID</th>
                                <th>登录状态</th>
                                <th>活跃状态</th>
                                <th>创建时间</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="accountList">
                            <tr>
                                <td colspan="6" class="text-center text-muted">
                                    <i class="bi bi-inbox"></i> 暂无账号，请添加
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- 说明卡片 -->
        <div class="card mt-4">
            <div class="card-header">
                <i class="bi bi-question-circle"></i> 使用说明
            </div>
            <div class="card-body">
                <h6><i class="bi bi-1-circle"></i> 配置API密钥（首次使用）</h6>
                <ol>
                    <li>访问 <a href="https://my.telegram.org/apps" target="_blank">https://my.telegram.org/apps</a></li>
                    <li>使用您的手机号登录</li>
                    <li>创建一个新的应用</li>
                    <li>复制 <strong>api_id</strong> 和 <strong>api_hash</strong></li>
                    <li>在项目根目录的 <code>.env</code> 文件中配置：
                        <pre class="bg-light p-2 mt-2 mb-0"><code>TELEGRAM_API_ID=你的api_id
TELEGRAM_API_HASH=你的api_hash</code></pre>
                    </li>
                    <li>重启应用使配置生效</li>
                </ol>
                
                <h6 class="mt-3"><i class="bi bi-2-circle"></i> 添加账号</h6>
                <ol>
                    <li>点击"添加账号"按钮</li>
                    <li>输入手机号（包含国家代码，如 +86）</li>
                    <li>输入收到的验证码</li>
                    <li>（如启用了两步验证）输入两步验证密码</li>
                    <li>登录成功后，可设置为活跃账号用于任务执行</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<!-- 添加账号模态框 -->
<div class="modal fade" id="addAccountModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-person-plus"></i> 添加Telegram账号
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <!-- 步骤1: 输入手机号 -->
                <form id="loginForm">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i> 
                        API ID和API Hash已从配置文件读取
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">手机号</label>
                        <input type="tel" class="form-control" id="phone" required
                               placeholder="+86 138 0000 0000">
                        <div class="form-text">包含国家代码，如 +86</div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="bi bi-box-arrow-in-right"></i> 发送验证码
                    </button>
                </form>
                
                <!-- 步骤2: 输入验证码 -->
                <form id="verifyForm" style="display: none;">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i> 验证码已发送到您的Telegram
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">验证码</label>
                        <input type="text" class="form-control" id="code" required
                               placeholder="输入收到的验证码">
                    </div>
                    
                    <button type="submit" class="btn btn-success w-100">
                        <i class="bi bi-check-circle"></i> 验证
                    </button>
                </form>
                
                <!-- 步骤3: 输入两步验证密码 -->
                <form id="passwordForm" style="display: none;">
                    <div class="alert alert-warning">
                        <i class="bi bi-shield-lock"></i> 需要两步验证密码
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">两步验证密码</label>
                        <input type="password" class="form-control" id="password" required
                               placeholder="输入两步验证密码">
                    </div>
                    
                    <button type="submit" class="btn btn-success w-100">
                        <i class="bi bi-check-circle"></i> 验证
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/auth.js') }}"></script>
{% endblock %}
